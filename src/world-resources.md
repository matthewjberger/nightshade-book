# World & Resources

The `World` is the central data container in Nightshade. It holds all entities, components, and global resources.

## World Structure

The World is generated by the `freecs::ecs!` macro and contains:

```rust
pub struct World {
    pub entities: EntityStorage,

    pub resources: Resources,
}
```

## Resources

Resources are global singletons accessible throughout the engine:

```rust
pub struct Resources {
    pub window: Window,
    pub user_interface: UserInterface,
    pub immediate_ui: ImmediateUi,
    pub graphics: Graphics,
    pub input: Input,
    pub audio: AudioEngine,
    pub physics: PhysicsWorld,
    pub navmesh: NavMeshWorld,
    pub text_cache: TextCache,
    pub mesh_cache: MeshCache,
    pub animation_cache: AnimationCache,
    pub prefab_cache: PrefabCache,
    pub material_registry: MaterialRegistry,
    pub texture_cache: TextureCache,
    pub active_camera: Option<Entity>,
    pub event_bus: EventBus,
    pub command_queue: Vec<WorldCommand>,
    pub children_cache: HashMap<Entity, Vec<Entity>>,
    pub dropped_files: Vec<DroppedFile>,
}
```

There is no separate `Time` resource. Timing information is accessed through `world.resources.window.timing`.

## Accessing Resources

Resources are accessed through `world.resources`:

```rust
fn run_systems(&mut self, world: &mut World) {
    let dt = world.resources.window.timing.delta_time;

    if world.resources.input.keyboard.is_key_pressed(KeyCode::Space) {
        self.jump();
    }

    world.resources.graphics.bloom_enabled = true;
    world.resources.graphics.bloom_intensity = 0.5;
}
```

## Common Resources

### Time & Timing

Timing is accessed through `world.resources.window.timing`:

```rust
let dt = world.resources.window.timing.delta_time;
let fps = world.resources.window.timing.frames_per_second;
let elapsed = world.resources.window.timing.uptime_milliseconds as f32 / 1000.0;
```

### Input

```rust
if world.resources.input.keyboard.is_key_pressed(KeyCode::KeyW) {
    move_forward();
}

let mouse_pos = world.resources.input.mouse.position;

if world.resources.input.mouse.state.contains(MouseState::LEFT_JUST_PRESSED) {
    shoot();
}
```

### Graphics Settings

```rust
world.resources.graphics.show_grid = true;
world.resources.graphics.atmosphere = Atmosphere::Sky;
world.resources.graphics.bloom_enabled = true;
world.resources.graphics.ssao_enabled = true;

world.resources.graphics.tonemap_method = TonemapMethod::Aces;
```

### Active Camera

```rust
world.resources.active_camera = Some(camera_entity);

if let Some(camera) = world.resources.active_camera {
    let transform = world.get_global_transform(camera);
}
```

## Deferred Commands

Some operations must be deferred to avoid invalidating iterators:

```rust
world.command_queue.spawn(|world| {
    let entity = world.spawn_entities(LOCAL_TRANSFORM | GLOBAL_TRANSFORM, 1)[0];
    world.set_local_transform(entity, LocalTransform::default());
});

world.command_queue.despawn(entity);

world.command_queue.flush(world);
```

## Queuing World Commands

For GPU resource operations:

```rust
world.queue_command(WorldCommand::LoadTexture {
    name: "my_texture".to_string(),
    rgba_data: texture_bytes,
    width: 256,
    height: 256,
});
```
